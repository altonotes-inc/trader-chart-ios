# テクニカル指標仕様

## 共通仕様
- テクニカル指標の計算は浮動小数点数（iOSはCGFloat、AndroidはDouble）を用いて行う

### 共通の前提式

以下の式は複数のテクニカル指標で共通して用いる。

- O(t) ＝ t番目の始値
- H(t) ＝ t番目の高値
- L(t) ＝ t番目の安値
- C(t) ＝ t番目の終値
- HIGH(t, n) ＝ t番目を含む過去n本間の最高値（t〜(t - n + 1)番目の足の中での最高値）
- LOW(t, n) ＝ t番目を含む過去n本間の最安値（t〜(t - n + 1)番目の足の中での最安値）
- MAX(x, y) ＝ x、yのうち最大の値
- MIN(x, y) ＝ x、yのうち最小の値
- NULL ＝ 値無しを表す。iOSでは`nil`、Androidでは`null`

## 単純移動平均

### 概要
スパン内の終値の平均値

### パラメーター

- スパン（N）

### 前提式

- SMA(t) = t番目の単純移動平均

### 各値の計算式

■ 最初の値（SMA(t-1)がない場合）  
SMA(t) ＝ {C(t) + C(t - 1) + … + C(t - N + 1)} ÷ N

■ 2番目以降の値（SMA(t-1)がある場合）  
SMA(t) ＝ SMA(t - 1) + {C(t) - C(t - N)} ÷ N

### 例外値
- SMA(t) ＝ t番目の足において、有効な終値が過去N本以上連続して存在しない場合はNULL

## 指数平滑移動平均

### 概要
古いデータの重みを指数関数的に減少させた移動平均

### パラメーター

- スパン（N）

### 前提式

- EMA(t) = t番目の指数平滑移動平均

### 各値の計算式

■ 最初の値（EMA(t-1)がない場合）  
EMA(t) ＝ {C(t) + C(t - 1) + … + C(t - N + 1)} ÷ N

■ 2番目以降の値（EMA(t-1)がある場合）  
EMA(t) ＝ EMA(t - 1) + {2 ÷ (N + 1)} × { C(t) - EMA(t - 1)}

### 例外値
- EMA(t) ＝ t番目の足において、有効な終値が過去N本以上連続して存在しない場合はNULL

## 一目均衡表
### 概要
転換線、基準線、遅行線、先行線1、先行線2の5本の線と、先行線1、先行線2に囲まれた部分（雲）で構成される指標

### パラメーター

- 転換スパン (T)
- 基準スパン (K)
- スパン (N)
- 先行スパン (S) = N x 2

### 各値の計算式

- 転換線(t)  = { HIGH(t, T) + LOW(t, T) } ÷ 2
- 基準線(t)  = { HIGH(t, K) + LOW(t, K) } ÷ 2
- 遅行線(t)  = C(t + (N - 1))
- 先行線1(t) = { 転換線(t - (N - 1)) + 基準線(t - (N - 1)) } ÷ 2
- 先行線2(t) = { HIGH(t - (N - 1), S) + LOW(t - (N - 1), S) } ÷ 2

### 例外値


## ボリンジャーバンド

### 概要
移動平均に標準偏差をプラス、マイナスした上下のバンドで構成される指標

### パラメーター

- スパン (N)
- 倍率 (R)　（±1σ、±2σ、±3σなどの1、2、3の部分）

### 前提式
- SMA(t, N) = t番目の終値のスパンNの単純移動平均（計算式は単純移動平均の項を参照）
- D(t, n) = {C(t - n) - SMA(t, N)} ^ 2
- SD(t) = sqrt{ ( D(t, 0) + D(t, 1) + ... + D(t, N - 2) + D(t, N - 1)) ÷ N } ※標準偏差

### 各値の計算式

- +Rσ = SMA(t) + SD(t) × R
- -Rσ = SMA(t) - SD(t) × R
        
## ストキャスティクス
### 概要
一定期間の高値と安値を用いて、買われ過ぎまたは売られ過ぎを判断する指標

### パラメーター

- %Kのスパン (Nk)
- %Dのスパン (Nd)
- Slow%Dのスパン (Ns)

### 各値の計算式

- %K(t) = ( C(t) - LOW(t, Nk) ) ÷ ( HIGH(t, Nk) - LOW(t, Nk) ) × 100
- %D(t) = ( C(t) - LOW(t, Nk) )のNd本の合計 ÷ ( HIGH(t, Nk) - LOW(t, Nk) )のNd本の合計 × 100
- Slow%D(t) = %DのスパンNsの単純移動平均（計算式は単純移動平均の項を参照）

## MACD
### 概要
短期EMAと長期EMAの差

### パラメーター

- 短期スパン (Ns)
- 長期スパン (Nl)
- シグナルスパン (Nsig)

### 前提式
- EMA(t, N) ＝ t番目の終値のスパンNの指数平滑移動平均（計算式は指数平滑移動平均の項を参照）

### 各値の計算式

- MACD(t) ＝ EMA(t, Ns) - EMA(t, Nl)
- シグナル(t) ＝ MACDのEMA(t, Nsig) (※1)
- オシレーター(t) ＝ MACD(t) - シグナル(t)

(※1)シグナルは標準では指数平滑移動平均ですが、単純移動平均に変更することもできます

## RSI

### 概要
一定期間において値上がり、値下がりどちらの勢いが強いかを表す指標  
RSIにはいくつかの計算方法があるが、本ライブラリは「CutlerのRSI」の計算方法を用いる

### パラメーター
- スパン (N)

### 前提式

- UP(t) ＝ C(t) - C(t - 1)  
※C(t - 1)が存在しないか、UP(t)がマイナスになる場合は0
- DOWN(t) ＝ C(t - 1) - C(t)  
※C(t - 1)が存在しないか、DOWN(t)がマイナスになる場合は0
- USUM(t) ＝ UP(t)のN本の合計
- DSUM(t) ＝ DOWN(t)のN本の合計

### 各値の計算式

- RSI(t) = USUM(t) ÷ ( USUM(t) + DSUM(t) ) × 100

## RCI

### 概要
期間内の特定の位置の終値の順位と、その位置との相関関係を用いて計算される指標

### パラメーター
- スパン (N)
- D = N * (N^2 - 1)

### 前提式

- RANK(t, i) ＝ C(t - i)のC(t)〜C(t - N + 1)内の順位（1始まりで高い方から昇順）  
※ 同値が複数ある場合の順位は平均値とする。例えば1、2、3位が同値の場合、(1 + 2 + 3) ÷ 3 ＝ 2位とする
- D(t, i) = (i + 1) - RANK(t, i)
- SIGMA(t) ＝ D(t, 0)^2 + D(t, 1)^2 + ... + D(t, N - 2)^2 + D(t, N - 1)^2

### 各値の計算式

- RCI(t) = { 1 - 6 × SIGMA(t) ÷ D } × 100

## DMI(ADX)

### 概要
高値の更新と安値の更新を用いてトレンドの方向性、強弱を判断する指標

### パラメーター
- 平均スパン (N)
- ADXスパン (Nx)
- ADXRスパン (Nr)

### 前提式

- ABS(x) ＝ xの絶対値
- MAX(a, b, ..., y, z) ＝ 引数の中の最大の値
- 高値更新(t) ＝ H(t - 1) < H(t) なら H(t) - H(t - 1)、それ以外の場合0
- 安値更新(t) ＝ L(t - 1) > L(t) なら L(t - 1) - L(t)、それ以外の場合0
- +DM(t) ＝ 高値更新(t) > 安値更新(t) なら 高値更新(t)、それ以外の場合0
- -DM(t) ＝ 高値更新(t) < 安値更新(t) なら 安値更新(t)、それ以外の場合0
- TR(t) ＝ MAX( H(t) - L(t), H(t) - C(t - 1), C(t - 1) - L(t) )
- AV(t, +DM) ＝ +DMの、スパンNの単純移動平均のt番目
- AV(t, -DM) ＝ -DMの、スパンNの単純移動平均のt番目
- AV(t, TR) ＝  TRの、スパンNの単純移動平均値のt番目

### 各値の計算式

- +DI(t) ＝ AV(t, +DM) ÷ AV(t, TR)
- -DI(t) ＝ AV(t, -DM) ÷ AV(t, TR)
- DX(t) ＝ ABS(+DI(t) - -DI(t)) ÷ (+DI(t) + -DI(t))
- ADX(t) ＝ DXのスパンNxの単純移動平均
- ADXR(t) ＝ ADXのスパンNrの単純移動平均

## 転換点

### 概要
相場のトレンドが上昇から下降、または下降から上昇に転換する点において、切り返し点での最高値（天）と最低値（底）を表示する。

### 転換点の判定方法
●対象の足(x)が過去10本、未来10本の中で最高値の場合、以下の基準で「天」の転換点になり得るかどうかを判定する。

 ①.直近の転換点が底：直近の転換点のリバーサル値(*)を超えている→天としての新しい転換点として追加。

 ②.直近の転換点が天：直近の転換点の値を超えている→直近の天を更新した新しい天として直近の転換点を上書きする。  
    ●対象の足(x)が過去10本、未来10本の中で最安値の場合、以下の基準で「底」の転換点になり得るかどうかを判定する。

 ①.直近の転換点が天：直近の転換点のリバーサル値(*)を下回っている → 底としての新しい転換点として追加。

 ②.直近の転換点が底：直近の転換点の値を下回っている → 直近の底を更新した新しい底として直近の転換点を上書きする。


### (*)リバーサル値の算出式
・転換点が底の場合  
リバーサル値 ＝ 転換点の値＋(転換点直前10本の最高値－転換点の値)×0.5

・転換点が天の場合  
リバーサル値 ＝ 転換点の値＋(転換点直前10本の最安値－転換点の値)×0.5

■最初の転換点の決め方  
計算の一番最初には直近の転換点が存在しないため、その足が過去10本、未来10本の中で最高値であるならば無条件に天として扱い、最安値であれば底として扱う。

## 多重移動平均

### 概要
スパンを変えた単純移動平均を複数本表示する。  
スパンは最短期間から最長期間の間を本数で均等分割して定める。

### パラメーター
- 最短期間 (N1)
- 最長期間 (N2)
- 本数 (C)

### 前提式

- SMA(t, S) = t番目のスパンSの終値の単純移動平均
- MSMA(n, t) ＝ n本目、t番目の多重移動平均
- STEP ＝ (N2 - N1) ÷ (C - 1)
- ROUND(x) ＝ xを四捨五入した整数

### 各値の計算式

- MSMA(n, t) ＝ SMA(t, ROUND(N1 + STEP × n))

## モメンタム（割り算）

### 概要
終値とN本前の終値の比率。

### パラメーター
- スパン（N）

### 各値の計算式

- モメンタム(t) ＝ C(t) ÷ C(t - N) × 100

## パラボリック

### 概要

上昇トレンドと下降トレンドの転換を測る指標。

### パラメーター

- 加速因子 (BaseAF)
- 加速因子上限 (MaxAF)

### 初期トレンドの決め方

トレンドの初期値は以下のように決める。

始値(t - 1) <  終値(t - 1) のとき、トレンド(t)＝「上昇トレンド」  
始値(t - 1) >= 終値(t - 1) のとき、トレンド(t)＝「下降トレンド」

SAR ＝   
上昇トレンドのとき: 安値(0)  
下降トレンドのとき: 高値(0)  

### トレンドの転換

### 前提式

- TREND(t) ＝ 上昇トレンド、または下降トレンド
- EP(t) ＝ 極大値。「上昇トレンド」が続く期間内の最高値、または「下降トレンド」が続く期間内の最安値
- AF(t) ＝ 加速係数。加速因子(BaseAF)を初期値とし、EPが更新されるたびに BaseAF ずつ増加する。AFは上限をMaxAFとし、MaxAFを超える場合はAFをMaxAFとする
- TEMPSAR(t) = パラボリックSARの仮値。
- SAR(t) = パラボリックSAR。グラフに描画される値。

### 各値の計算式

- TEMPSAR(t) ＝ SAR(t - 1) + AF(t - 1) × {EP(t - 1) - SAR(t - 1)}

### トレンド転換の判定

- 上昇トレンドかつ L(t) < TEMPSAR(t)の場合、下降トレンドに転換
- 下降トレンドかつ TEMPSAR(t) < H(t)の場合、上昇トレンドに転換

#### トレンド継続時
- SAR(t) ＝ TEMPSAR(t)
- EP(t) ＝  
上昇トレンドの場合、MAX(EP(t - 1), H(t))  
下降トレンドの場合、MIN(EP(t - 1), L(t))  
- AF(t) ＝ MIN( EPが更新された場合AF(t - 1) + BaseAF、その他はAF(t - 1), MaxAF)

#### トレンド転換時
- SAR(t) ＝ EP(t - 1)
- EP(t) ＝ 上昇から下降に転換するときL(t) 、下降から上昇に転換するときH(t)
- AF(t) ＝ BaseAF

## 移動平均乖離率

### 概要
終値が移動平均とどれだけ離れているかの割合

### パラメーター
- スパン（N）

### 前提式
- SMA(t) = t番目の単純移動平均

### 各値の計算式
- 移動平均乖離率(t) ＝ {(C(t) - SMA(t)) ÷ SMA(t)} × 100

## 標準偏差

### 概要
データの散らばりの度合いを示す値。  
それぞれの終値と平均値の差の二乗平均の平方根。

### パラメーター
- スパン（N）

### 前提式
- DIFF(t, i) ＝ {C(i) - SMA(t)} ^ 2
- SIGMA(t) ＝ DIFF(t, t) +  DIFF(t, t - 1) + ... + DIFF(t, t - N + 2) + DIFF(t, t - N + 1)

### 各値の計算式

標準偏差(t) ＝ √ (SIGMA(t) ÷ N)

## サイコロジカル

### 概要
直近N本の足の中の上昇した足の割合。

### パラメーター
- スパン（N）

### 前提式
UP(t) ＝ 直近N本の終値のうち一つ前の足の終値より大きいものの本数

### 各値の計算式
サイコロジカル(t) ＝ UP(t) ÷ N × 100
